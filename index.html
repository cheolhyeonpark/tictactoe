<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>tic-tac-toe</title>
    <style>
        .backboard {
            float: left;
            width: 33%;
        }

        .gameboard {
            float: left;
            width: 31%;
            padding-bottom: 31%;
            background-repeat: no-repeat;
            background-size: cover;
            background-position: center;
        }

        .right {
            border-right: 8px solid rgba(0, 0, 0, 0.5);
        }

        .bottom {
            border-bottom: 8px solid rgba(0, 0, 0, 0.5);
        }

        .circle {
            background-image: url('circleicon.jpg');
        }

        .cross {
            background-image: url('crossicon.png');
        }

        .background {
            background-color: darkslategray;
            padding-bottom: 32%;
            padding-top: 3%;
            padding-left: 4%;
        }

        .systemboard {
            margin: 25px;
        }

        select {
            width: 100%;
            padding: .8em .5em;
            margin-bottom: 10px;
            border: 1px solid #999;
            border-radius: 0px;
        }

        @media screen and (max-width: 740px) {
            .backboard {
                width: 100%;
            }

            .background {
                padding-bottom: 0;
            }

            .systemboard {
                margin-top: 0;
            }
        }

        button {
            background: #1AAB8A;
            color: #fff;
            border: none;
            position: relative;
            height: 60px;
            font-size: 1.6em;
            padding: 0 2em;
            cursor: pointer;
            outline: none;
            width: 100%;
        }

        button:active {
            background-color: aquamarine;
        }
    </style>
</head>

<body>
    <div class="background">
        <div class="backboard">&nbsp</div>
        <div class="backboard">
            <div class="gameboard right bottom" id="map-0-0"></div>
            <div class="gameboard right bottom" id="map-0-1"></div>
            <div class="gameboard bottom" id="map-0-2"></div>
            <div class="gameboard right bottom" id="map-1-0"></div>
            <div class="gameboard right bottom" id="map-1-1"></div>
            <div class="gameboard bottom" id="map-1-2"></div>
            <div class="gameboard right" id="map-2-0"></div>
            <div class="gameboard right" id="map-2-1"></div>
            <div class="gameboard" id="map-2-2"></div>
        </div>
        <div class="backboard">&nbsp</div>
        &nbsp
    </div>
    <div>
        <div class="backboard">&nbsp</div>
        <div class="backboard">
            <div class="systemboard">
                <select id="difficulty">
                    <option value="1" selected> easy </option>
                    <option value="2"> medium </option>
                    <option value="3"> hard </option>
                </select>
                <select id="player">
                    <option value="playerO" selected> player O </option>
                    <option value="playerX"> player X </option>
                </select>
                <button id="startBtn">Game Start</button>
            </div>
        </div>
        <div class="backboard">&nbsp</div>
    </div>

    <script>
        var map = new Array();
        map[0] = new Array();
        map[1] = new Array();
        map[2] = new Array();

        var human = -1;
        var turn = -1;
        var cnt = 0;
        var level = 1;

        reset();
        function reset() {
            console.log(cnt);
            cnt = 0;
            level = document.getElementById("difficulty").value;
            for (var i = 0; i < 3; i++) {
                for (var j = 0; j < 3; j++) {
                    map[i][j] = 0;
                    document.getElementById("map-" + i + "-" + j).classList.remove('circle');
                    document.getElementById("map-" + i + "-" + j).classList.remove('cross');
                }
            }
            if (document.getElementById("player").value == 'playerO') {
                turn = -1;
                human = -1;
            } else {
                turn = -1;
                human = 1;
                computerTurn();
            }
        }

        var clickStartBtn = document.getElementById("startBtn");
        clickStartBtn.addEventListener('click', function () {
            reset();
        });

        var gameboard = document.getElementsByClassName("gameboard");

        for (var i = 0; i < gameboard.length; i++) {
            gameboard[i].addEventListener('click', function () {
                var x = 0;
                var y = 0;
                x = parseInt(this.id.split('-')[1]);
                y = parseInt(this.id.split('-')[2]);
                if (map[x][y] != 0) {
                    return;
                } else {
                    map[x][y] = turn;
                }
                var target = document.getElementById(this.id);
                circleorcross(target);
                turn *= -1;
                cnt++;
                checkWinner(-1);
            });
        }

        function circleorcross(target) {
            if (turn == -1) {
                target.classList.add('circle');
            } else {
                target.classList.add('cross');
            }
        }

        function checkWinner(play) {
            
            setTimeout(function () {
                var winner = checkWin();
                if (winner != 0) {
                    if (winner == human) {
                        alert("You win!");
                    } else {
                        alert("You lose!")
                    }
                    reset();
                } else if (cnt >= 9) {
                    alert("draw");
                    reset();
                } else {
                    if (play == -1) {
                        computerTurn();
                    }
                }
            }, 500);
        }

        function checkWin() {
            if (map[0][0] != 0 && map[0][0] == map[0][1] && map[0][1] == map[0][2]) return map[0][0];
            else if (map[1][0] != 0 && map[1][0] == map[1][1] && map[1][1] == map[1][2]) return map[1][0];
            else if (map[2][0] != 0 && map[2][0] == map[2][1] && map[2][1] == map[2][2]) return map[2][0];
            else if (map[0][0] != 0 && map[0][0] == map[1][0] && map[1][0] == map[2][0]) return map[0][0];
            else if (map[0][1] != 0 && map[0][1] == map[1][1] && map[1][1] == map[2][1]) return map[0][1];
            else if (map[0][2] != 0 && map[0][2] == map[1][2] && map[1][2] == map[2][2]) return map[0][2];
            else if (map[0][0] != 0 && map[0][0] == map[1][1] && map[1][1] == map[2][2]) return map[0][0];
            else if (map[0][2] != 0 && map[0][2] == map[1][1] && map[1][1] == map[2][0]) return map[0][2];
            else return 0;
        }

        function computerTurn() {
            if (level == 1) {
                level1();
            } else if (level == 2) {
                level2();
            } else {
                level3();
            }
            turn *= -1;
            cnt++;
            checkWinner(1);
        }

        function level1() {
            var x = Math.floor(Math.random() * 3);
            var y = Math.floor(Math.random() * 3);
            while (map[x][y] != 0) {
                x = Math.floor(Math.random() * 3);
                y = Math.floor(Math.random() * 3);
            }
            circleorcross(document.getElementById("map-" + x + "-" + y));
            map[x][y] = turn;
        }

        function level2() {
            if (cnt < 2) {
                level(1);
            }
            else if (map[0][0] == 0 && map[0][1] == map[0][2]) {
                map[0][0] = turn;
                circleorcross(document.getElementById("map-0-0"));
            }
            else if (map[0][1] == 0 && map[0][0] == map[0][2]) {
                map[0][1] = turn;
                circleorcross(document.getElementById("map-0-1"));
            }
            else if (map[0][2] == 0 && map[0][1] == map[0][0]) {
                map[0][2] = turn;
                circleorcross(document.getElementById("map-0-2"));
            }
            else if (map[1][0] == 0 && map[1][1] == map[1][2]) {
                map[1][0] = turn;
                circleorcross(document.getElementById("map-1-0"));
            }
            else if (map[1][1] == 0 && map[1][0] == map[1][2]) {
                map[1][1] = turn;
                circleorcross(document.getElementById("map-1-1"));
            }
            else if (map[1][2] == 0 && map[1][1] == map[1][0]) {
                map[1][2] = turn;
                circleorcross(document.getElementById("map-1-2"));
            }
            else if (map[2][0] == 0 && map[2][1] == map[2][2]) {
                map[2][0] = turn;
                circleorcross(document.getElementById("map-2-0"));
            }
            else if (map[2][1] == 0 && map[2][0] == map[2][2]) {
                map[2][1] = turn;
                circleorcross(document.getElementById("map-2-1"));
            }
            else if (map[2][2] == 0 && map[2][1] == map[2][0]) {
                map[2][2] = turn;
                circleorcross(document.getElementById("map-2-2"));
            }
            else if (map[0][0] == 0 && map[1][0] == map[2][0]) {
                map[0][0] = turn;
                circleorcross(document.getElementById("map-0-0"));
            }
            else if (map[1][0] == 0 && map[0][0] == map[2][0]) {
                map[1][0] = turn;
                circleorcross(document.getElementById("map-1-0"));
            }
            else if (map[2][0] == 0 && map[1][0] == map[0][0]) {
                map[2][0] = turn;
                circleorcross(document.getElementById("map-2-0"));
            }
            else if (map[0][1] == 0 && map[1][1] == map[2][1]) {
                map[0][1] = turn;
                circleorcross(document.getElementById("map-0-1"));
            }
            else if (map[1][1] == 0 && map[0][1] == map[2][1]) {
                map[1][1] = turn;
                circleorcross(document.getElementById("map-1-1"));
            }
            else if (map[2][1] == 0 && map[1][1] == map[0][1]) {
                map[2][1] = turn;
                circleorcross(document.getElementById("map-2-1"));
            }
            else if (map[0][2] == 0 && map[1][2] == map[2][2]) {
                map[0][2] = turn;
                circleorcross(document.getElementById("map-0-2"));
            }
            else if (map[1][2] == 0 && map[0][2] == map[2][2]) {
                map[1][2] = turn;
                circleorcross(document.getElementById("map-2-2"));
            }
            else if (map[2][2] == 0 && map[1][2] == map[0][2]) {
                map[2][2] = turn;
                circleorcross(document.getElementById("map-2-2"));
            }
            else if (map[0][0] == 0 && map[1][1] == map[2][2]) {
                map[0][0] = turn;
                circleorcross(document.getElementById("map-0-0"));
            }
            else if (map[1][1] == 0 && map[0][0] == map[2][2]) {
                map[1][1] = turn;
                circleorcross(document.getElementById("map-1-1"));
            }
            else if (map[2][2] == 0 && map[1][1] == map[0][0]) {
                map[2][2] = turn;
                circleorcross(document.getElementById("map-2-2"));
            }
            else if (map[0][2] == 0 && map[1][1] == map[2][0]) {
                map[0][2] = turn;
                circleorcross(document.getElementById("map-0-2"));
            }
            else if (map[1][1] == 0 && map[0][2] == map[2][0]) {
                map[1][1] = turn;
                circleorcross(document.getElementById("map-1-1"));
            }
            else if (map[2][0] == 0 && map[1][1] == map[0][2]) {
                map[2][0] = turn;
                circleorcross(document.getElementById("map-2-0"));
            }
            else level1();
        }

        function level3() {
            if (cnt < 2) {
                level1();
            } else {
                var x = 0;
                var y = 0;
                var max = -100;
                var ret = 0;
                for (var i = 0; i < 3; i++) {
                    for (var j = 0; j < 3; j++) {
                        if (map[i][j] != 0) continue;
                        map[i][j] = turn;
                        ret = repeat(turn * -1);
                        map[i][j] = 0;
                        if (max < ret) {
                            max = ret;
                            x = i;
                            y = j;
                        }
                    }
                }
                circleorcross(document.getElementById("map-" + x + "-" + y));
                map[x][y] = turn;
            }
        }

        function repeat(play, depth) {
            var ret = 0;
            ret = checkWin();
            if (ret == human) return -1;
            else if (ret == 0) {
                ret = 0;
                for (var i = 0; i < 3; i++) {
                    for (var j = 0; j < 3; j++) {
                        if (map[i][j] != 0) continue;
                        map[i][j] = play;
                        ret += repeat(play * -1);
                        map[i][j] = 0;
                    }
                }
                return ret;
            } else {
                return 1;
            }
        }
    </script>
</body>

</html>